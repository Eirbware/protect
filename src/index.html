<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demo protect</title>
<script type="module">
import protect from "/lib/protect.js";

/*
 *  Same site code
 */
const samesite = document.getElementById("samesite");
async function dataButton()
{
    try
    {
        const data = await protect.getData();
        alert(JSON.stringify(data));
    }
    catch (err)
    {
        alert(err);
    }
}


function dataButton2()
{
    protect.getData()
        .then(data => alert(JSON.stringify(data)))
        .catch(err => {
            alert(err);
            // Could not get data, try to login
            protect.login();
        });
}

samesite.querySelector(".login").onclick = () => protect.login();
samesite.querySelector(".get-data").onclick = () => dataButton();
samesite.querySelector(".get-data2").onclick = () => dataButton2();
samesite.querySelector(".redirect").onclick = () => protect.redirect("video");
samesite.querySelector(".redirect2").onclick = () => protect.redirect("url_pas_valide");
samesite.querySelector(".redirect3").onclick = () => protect.redirect("doesntexist");
samesite.querySelector(".logout").onclick = () => protect.logout();


/*
 * backend_protect code
 */
const backendProtect = document.getElementById("backend-protect");
const remoteOptions = {protectOrigin: "https://bds.eirb.fr"}

// Example using async await
async function protectDataButton()
{
    try
    {
        const data = await protect.getData(remoteOptions);
        alert(JSON.stringify(data));
    }
    catch (err)
    {
        alert(err);
    }
}

// Example using Promise.then() and Promise.catch()
function protectDataButton2()
{
    protect.getData(remoteOptions)
        .then(data => alert(JSON.stringify(data)))
        .catch(err => {
            alert(err);
            // Could not get data, try to login
            protect.login(remoteOptions);
        });
}

backendProtect.querySelector(".login").onclick = () => protect.login(remoteOptions);
backendProtect.querySelector(".get-data").onclick = () => protectDataButton(remoteOptions);
backendProtect.querySelector(".get-data2").onclick = () => protectDataButton2(remoteOptions);
backendProtect.querySelector(".redirect").onclick = () => protect.redirect("video", remoteOptions);
backendProtect.querySelector(".redirect2").onclick = () => protect.redirect("url_pas_valide", remoteOptions);
backendProtect.querySelector(".redirect3").onclick = () => protect.redirect("doesntexist", remoteOptions);
backendProtect.querySelector(".logout").onclick = () => protect.logout(remoteOptions);
</script>
</head>
<body>
    <h1>Demo protect by Eirbware</h1>

    <section id="samesite">
        <h1>Avec le backend du site</h1>

        <div>
            <button class="login">Login</button>
            <button class="get-data">Voir les données</button>
            <button class="get-data2">Voir les données mais login si fail</button>
            <button class="redirect">Vidéo de liste</button>
            <button class="redirect2">Lien non valide</button>
            <button class="redirect3">Lien non défini</button>
            <button class="logout">Logout</button>
        </div>
    </section>

    <section id="backend-protect">
        <h1>Avec le backend de protect.eirb.fr (ne fonctionne qu'en local)</h1>

        <div>
            <button class="login">Login</button>
            <button class="get-data">Voir les données</button>
            <button class="get-data2">Voir les données mais login si fail</button>
            <button class="redirect">Vidéo de liste</button>
            <button class="redirect2">Lien non valide</button>
            <button class="redirect3">Lien non défini</button>
            <button class="logout">Logout</button>
        </div>
    </section>
</body>
</html>
